---
title: STM32 程序烧录
tags:
  - 硬件拾忆
  - STM32
abbrlink: 5087e30b
date: 2019-03-04 09:38:22
---

---

STM32 的程序烧录方法有多种：USB、串口、JTAG、SWD等。



开发板串口烧录时，mcuisp 软件设置 DTR 低电平复位，RTS 高电平进 BootLoader，选择编程前重装文件，编程后执行，校验，不要选择使用 RamIsp。

<!--more-->

JLINK v8 支持 JTAG 和 SW



------

STM32 启动方式：

| BOOT0 | BOOT1 | 启动模式       | 说明                            |
| ----- | ----- | -------------- | ------------------------------- |
| 0     | X     | 用户闪存存储器 | 用户闪存存储器，也就是FLASH启动 |
| 1     | 0     | 系统存储器     | 系统存储器启动                  |
| 1     | 1     | SRAM 启动      | SRAN启动，用于在SRAM中调试代码  |



用户闪存，即芯片内置的 FLASH，从用户闪存启动是正常的工作模式；



SRAM，是芯片内置的 RAM 区，就是内存；



系统存储器，是芯片内部一块特定的区域，芯片出厂时，在这个区域预置了一段 Bootloader，就是通常说的 ISP 程序，这个区域的内容在芯片出场后，没有人能够修改或擦除，即它是一个 ROM 区。



标准的 ISP 下载步骤（串口下载）：



​    ① 配置 BOOT0 为 1，BOOT1 为 0



​    ② 按复位键



​    ③ 通过程序下载代码



​    ④ 下载完成后将 BOOT0 设置为 GND，以便每次复位后都可以运行用户代码



一般不使用内置 SRAM 启动，因为 SRAM 掉电数据丢失。多数情况下 SRAM 只在调试时使用，也可以做其他用途，如故障的局部诊断，写一小段程序加载到 SRAM 中诊断板上的其他电路，或用此方法读写板上的 FLASH 或 EEPROM 等。还可以通过这种方法接触内部FLASH的读写保护，当然接触读写保护的同时，FLASH 的内容也被自动清除，以防止恶意的软件拷贝。



一般 BOOT0 和 BOOT1 跳线都跳到 0。只是在 ISP 下载的情况下，BOOT0=1，BOOT1=0，下载完成后，把 BOOT0 的跳线接回 0。



STM32 内部 FLASH 地址起始于 0x08000000，一般情况下，程序文件就从此地址开始写入。此外 STM32 是基于Cortex-M3 内核的微控制器，其内部通过一张“中断向量表”来响应中断，程序启动后，将首先从“中断向量表”取出复位中断向量执行复位中断程序完成启动，而这张“中断向量表”的起始地址 0x08000004，当中断来临，STM32 的内部硬件机制亦会自动将 PC 指针定位到“中断向量表”处，并根据中断源取出对应的中断向量执行中断服务程序。复位中断服务函数执行完之后，会跳转到 main 函数。