---
title: MSP430 IO
date: 2019-02-22 16:11:34
tags:
    - 硬件拾忆
    - MSP430
---

---

### 注意事项

上电后寄存器状态为输入高电平。

改变 PxOUT 或 PxDIR 时 PxIFG 标志将置位。

向 PxIES 写入数据将导致相应的中断标志置位。

<!--more-->

只置位 PxSELx 不能自动设置引脚方向。其他外设模块需要跟据模块功能配置 PxDIRx，改变引脚方向。

<font color=#FF0000> 开启外部中断时，要先设置 OUT、DIR、IES，然后复位 IFG，最后开中断。 </font>

msp430x14x、x15x、x16x的 P1、P2 口具有中断能力。

未使用的IO引脚应配置成IO功能，输出方向，并连接在PCB板上，以降低功耗。PxOUT位的值无所谓，因为其引脚未连接。

未使用的引脚的正确连接方式：

![1550824357362](https://i.loli.net/2019/02/22/5c6fb3c7b5cc8.png)



### MSP430 IO 特点

- 独立的可编程 IO

- 同组 IO 口输入输出任意组合

- P1、P2 中断独立配置

- 输入输出数据寄存器独立



### 一、输入寄存器 PxIN

Bit = 0 ： 输入为低

Bit = 1 ： 输入为高



PxIN是只读寄存器，执行写入指令将增加电流消耗。



### 二、输出寄存器 PxOUT

Bit = 0 ： 输出为低

Bit = 1 ： 输出为高



### 三、方向寄存器 PxDIR

PxDIR 的每一位用来选择相应引脚的方向，无论选择了什么第二功能。



如果 IO 开启了第二功能，必须根据需要来设置相应的方向。



Bit = 0 ： 输入方向

Bit = 1 ： 输出方向



### 四、功能选择寄存器 PxSEL

端口引脚经常复用作其他内部外设模块功能。PxSEL 的每一位决定了引脚用作 IO 功能还是内部外设模块功能（第二功能）。



Bit = 0 ： IO功能

Bit = 1 ： 内部外设功能



只置位PxSELx不能自动设置引脚方向。其他外设模块需要跟据模块功能配置 PxDIRx，改变引脚方向。



PxSEL 置位时，中断关闭。



当引脚作为外设的输入时，输入到外设的信号在因脚伤经过一次锁存。当 PxSELx=1 时，内部输入信号跟随引脚上的输入信号。若 PxSELx=0，输入到外设的信号将维持引脚上的输入信号的值，直到 PxSELx 位重置。



- P1、P2 口可中断的器件
  - 通过配置 PxIFG、PxIE 和 PxIES 寄存器，P1 和 P2 口的每个引脚都能具有中断能力。所有的 P1 口引脚都使用一个单独的中断源，所有的 P2 引脚使用另一个单独的中断源。可以检测 PxIFG 来判断 P1 或 P2 中断。



### 五、中断标志位寄存器 P1IFG，P2IFG

选择的输入信号边沿出现在引脚上时，相应的中断标志会置位。相应的 PxIE 以及 GIE 置位后，所有 PxIFGx 中断标志都需要一个中断响应。PxIFG 必须由软件复位。软件也可以置位PxIFG，提供一种软件触发中断的方法。



Bit = 0 ： 无中断请求

Bit = 1 ： 中断请求



只有跳变能触发中断，而稳定的电平不能。如果任意 PxIFGx 在中断服务程序中置位，或者在中断服务程序执行 RETI 命令之后置位，PxIFGx 标志位将触发另一个中断。这样确保了每一个跳变得到响应。



<font color=#FF0000>   改变 PxOUT 或 PxDIR 时 PxIFG 标志将置位。 </font>



任何外部中断时间都应该至少是 MCLK 的 1.5 倍，以保证单片机能检测到并且中断标志置位。



### 六、中断边沿选择寄存器 P1IES，P2IES

PxIES 用来选择中断 IO 引脚的中断边沿。



Bit = 0 ： 由低向高的跳变置位 PxIFGx

Bit = 1 ： 由高向低的跳变置位 PxIFGx



<font color=#FF0000>   向 PxIES 写入数据将导致相应的中断标志置位。 </font>

| PxIESx | PxINx |   PxIFGx   |
| :----: | :---: | :--------: |
|  0→1   |   0   | May be set |
|  0→1   |   1   | Unchanged  |
|  1→0   |   0   | Unchanged  |
|  1→0   |   1   | May be set |



### 七、中断使能寄存器P1IE，P2IE

Bit = 0 ： 中断关闭

Bit = 1 ： 中断使能