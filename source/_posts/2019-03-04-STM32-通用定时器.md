---
title: STM32 通用定时器
tags:
  - 硬件拾忆
  - STM32
abbrlink: f7e075a6
date: 2019-03-04 16:30:13
---

---

### 一、stm32 定时器简介



高级定时器 TIM1 TIM8

通用定时器 TIM2~TIM5

基本定时器 TIM6 TIM7

<!--more-->

------

### 二、通用定时器



通用定时器通过一个可编程预分频器驱动的 16 位自动装在计数器构成。



它使用于多种场合，包括测量输入信号的脉冲长度（输入捕获）或者产生输出波形（输出比较和 PWM）。



使用定时器预分频器和 RCC 时钟控制器预分频器，脉冲长度和波形周期可以在几个微秒到几个毫秒间调整。



每个定时器完全独立，没有共享任何资源，可同步操作。 



通用定时器的功能包括：



1）16 位向上、向下、向上/向下自动装载计数器（TIMx_CNT）

2）16 位可编程（可实时修改）预分频器（TIMx_PSC），计数器时钟频率的分频系数为 1~65535 之间的任意数值。

3）4 个独立通道（TIMxCH1~4），这些通道可以用来作为：

​    A. 输入捕获

​    B. 输出比较

​    C. PWM 生成（边缘或中间对齐模式）

​    D. 单脉冲模式输出

4）可使用外部信号（TIMx_ETR）控制定时器和定时器互连（可以用1个定时器控制另外一个定时器）的同步电路。

5）如下事件发生时产生中断/DMA

- 更新：计数器向上溢出/向下溢出，计数器初始化（通过软件或者内/外部触发）

- 触发事件（计数器启动、停止、初始化或者由内/外部触发计数）

- 输入捕获

- 输出比较

6）支持针对定位的增量（正交）编码器和霍尔传感器电路

7）触发输入作为外部时钟或者按周期的电流管理



![Image.png](https://i.loli.net/2019/03/04/5c7ce26498d19.png)



---

### 三、通用定时器使用步骤：



1）TIMx 时钟使能

因为 Stm32_Clock_Init() 函数里把 APB1 的分频设置为 2，所以 TIM3 时钟是 APB1 时钟的 2 倍，等于 72M。

2）设置 TIM3_ARR 和 TIM3_PSC 的值

3）设置 TIM3_DIER 允许更新中断

4）允许 TIM3 工作

5）TIM3 中断分组

6）编写中断服务函数

