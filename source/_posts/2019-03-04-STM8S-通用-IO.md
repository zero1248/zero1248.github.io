---
title: STM8S 通用 IO
tags:
  - 硬件拾忆
  - STM8
abbrlink: e68e2e45
date: 2019-03-04 08:34:28
---

---

一、简介



一个 GPIO 端口可以包括多达 8 个引脚，每个引脚可独立编程为数字输入或数字输出口。部分口可能会有模拟输入，外部中断，片上外设的输入输出等复用功能。但是同一时刻只有一个复用功能可以映射到引脚上。复用功能的映射是通过选项字节控制的。

<!--more-->

---

二、GPIO 主要功能



- 浮空输入和上拉输入

- 推完输出和开漏输出

- 输入输出有各自的寄存器

- 外部中断可单独使能和关闭

- 输出摆率可单独使能和关闭

- 输出摆率控制用以较少 EMC 噪声

- 片上外设的 IO 功能复用

- 当作为模拟输入时可以关闭输入施密特触发器来降低功耗

- 数据输出锁存时支持 读-修改-写

- 输入兼容 5V

- IO 口工作电压范围为 1.6V 到 VDDIOmax



![Image.png](https://i.loli.net/2019/03/04/5c7c73c48bcea.png)



输出级在选择模拟输入时是禁止的。



---

三、IO 的配置和使用



每一个端口都有一个输出数据寄存器（ODR），一个引脚输入寄存器（IDR）和一个数据方向寄存器（DDR）总是同相关的。



控制寄存器 1（CR1）和控制寄存器 2（CR2）用于对输入/输出进行配置。任何一个 IO 引脚可以通过对 DDR，ODR，CR1 和 CR2 寄存器的相应位进行编程来配置。



![Image.png](https://i.loli.net/2019/03/04/5c7c7445f18b3.png)



在真正的漏极开路硅片引脚上不存在连接到 VDD 的二极管，在硅片引脚和 VOL 之间集成了局部保护，以保护设备免受 positive stress。



复位之后，所有引脚都是悬浮输入模式。个别引脚可能有其他动作。



没有使用的 IO 引脚不能保持悬空以避免额外的电流消耗，必须从以下配置选一个：

- 通过外部上拉或下拉电阻连接到 VDD 或 VSS，并设为悬空输入。

- 配置为输入，使用内部上下拉电阻

- 配置为推完输出低



小封装中有些 IO 端口的引脚数不足 8 个，对这些端口的寄存器进行写操作不会有任何影响，输入寄存器中相应位的读出值是 0。



![Image.png](https://i.loli.net/2019/03/04/5c7c74660b2bd.png)



如果 PA1/PA2 被用来连接外部谐振器，为了确保在 HALT 模式下有最低功耗，必须配置 PA1 和 PA2 为上拉输入。



---

三、输入模式详述



1、复用功能输入



部分 IO 口可以用作复用功能输入。例如：可以被用来作为输入到定时器的输入捕获口。复用的输入功能使不会自动选择的，用户可以通过写相应的外设寄存器的控制位来选择复用功能。



对于复用功能的输入，用户必须通过配置 DDR 和 CR1 寄存器设置将对应的 IO 口设为悬空或上拉输入。



2、中断功能



每一个中断向量都可以独立编程为上升沿或下降沿触发。



外部中断只有在对应 IO 口被设置为输入模式时才有效。



3、模拟通道



![Image.png](https://i.loli.net/2019/03/04/5c7c748fd9cc9.png)



4、施密特触发器



部分 IO 口包括一个内嵌的输入施密特触发器，可以通过 ADC_TDR 施密特触发器来禁止寄存器来使能/禁止施密特触发器。



---

四、输出模式详述



1、复用功能输出



复用功能使能时，复用功能模块接管了输出锁存寄存器（Px_ODR）并强制 Px_ODR 相应的位为 1。



复用输出功能可以是上拉或者开漏输出，取决于外设本身和控制寄存器（Px_CR1），输出摆率取决于控制寄存器 2（Px_CR2）的值。



例如：

考虑到要达到最佳性能，SPI 输出引脚必须设置为上拉，快速摆率。 UART_Tx 可以被配置为上拉或开漏输出（带外部上拉）来实现多从机的配置。



2、摆率控制



输出摆率可以使用 CR2 的相应位通过软件控制。置位 CR 相应位选择为 10MHz 的输出频率。该功能既可以用在开漏也可以用在带上拉的输出模式 IO 口，输出类型为 O3 或 O4。



---

五、GPIO 寄存器



输出数据寄存器     Px_ODR

输入数据寄存器     Px_IDR

数据方向寄存器     Px_DDR

控制寄存器1          Px_CR1

控制寄存器2          Px_CR2