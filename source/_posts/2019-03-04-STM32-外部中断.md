---
title: STM32 外部中断
date: 2019-03-04 16:10:21
tags:
    - 硬件拾忆
    - STM32
---

---

STM32 的每个 IO 口都可以作为中断输入，但每一个中断线只能分配到某一个 IO 口的相应管脚，如中断 2 只能分配到 PA2 或 PB2 或 PC2 等其中的一个。

<!--more-->

把 IO 口作为外部中断输入的步骤：



1、初始化 IO 为输入



可以上拉，下拉，或浮空输入。浮空的时候外部一定要上拉或下拉，否则中断可能不停触发。干扰打的地方，就算使用了内部上/下拉，最好外部再上/下拉一下，一定程度上防止外部干扰。



2、开启 IO 口复用时钟，设置 IO 口与中断线的映射关系



IO 口复用时钟在 RCC->APB2ENR 处使能（AFIOEN），在 AFIO->EXTICR 处将 EXTI.BITx 映射到 GPIO.BITx。



3、开启与该 IO 口相对的线上中断/事件，设置触发条件



从 EXTI->IMR 处开启中断请求，从 EXTI->EMR 处开启事件请求，从 EXTI->FTSR（下降沿）和 RTSR（上升沿）设置触发条件。



触发条件只能是上升沿或下降沿。不配置 EMR 位，软硬件仿真都可以进入外部中断，配置以后，软件仿真不能进入外部中断。



4、配置中断分组（NVIC），并使能中断



从 SCB->AIRCR[10:8] 配置中断分组，从 NVIC->ISER 使能外部中断，从 NVIC->IP 设置优先级。见 PM0056。



5、编写中断服务函数



0~4 有各自的 ISR：void EXTI0_IRQHandler(void)

9~5 共用 ISR：void EXTI9_5_IRQHandler(void)

15~10 共用 ISR：void EXTI15_10_IRQHandler(void)