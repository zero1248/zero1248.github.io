---
title: STM32 中断
tags:
  - 硬件拾忆
  - STM32
abbrlink: bc8a78ec
date: 2019-03-04 15:11:19
---

---

### 一、CM3 内核

​     

CM3 内核支持 256 个中断，其中前 16 个为内核中断，另外 240 个为外部中断，具有 256 级的可编程中断设置。

<!--more-->

### 二、stm32f1



stm32 有 84 个中断，包括 16 个内核中断和 68 个可屏蔽中断，具有 16 级可编程的中断优先级。f103 上只有 60 个中断，互联型如 f107 才有 68 个。



stm32f103 支持 19 个外部中断：

- 线 0~15：对应外部 IO 的输入中断
- 线 16：连接到 PVD 输出
- 线 17：连接到 RTC 闹钟事件
- 线 18：连接到 USB 唤醒事件



### 三、相关寄存器



向量中断控制器，简称 NVIC。访问地址 0xe000e000。



- ISER（8 个，用 3 个）Interrupt Set-Enable Registers
  -  中断使能。写 0 无效。

​     

- ICER（8 个，用 3 个）Interrupt Clear-Enable Registers
  - 清除使能。写 0 无效。



- ISPR（8 个，用 3 个）Interrupt Set-Pending Registers
  - 中断挂起，执行更高级中断。写 0 无效。



- ICPR（8个，用 3 个）Interrupt Clear-Pending Registers
  - 挂起解除。写 0 无效。



- IABR（8 个，用 3 个）Interrupt Active Bit Register
  - 中断活动标志，指示正在被执行的中断，硬件清零，只读。在处理器执行了某一种中断的 ISR 的第一条指令后，它的活动位就置 1，直到 ISR 返回时才硬件清零。即使该中断被抢占，其活动状态依然为 1。



- IP（240 个，用 68 个，高 4 位有效）Interrupt Priority Register



- STIR
  - 具体信息见 PM0056 STM32 内核编程手册



- SCB->AIRCR 设置分组
  - 共 5 组，0 表示 0 位抢占优先级，4 表示 4 位抢占优先级



- 软件中断
  - 最简单的方法是用 SETPEND 寄存器。更专业快捷的方法是用 STIR 寄存器



### 四、外部中断



IMR（中断屏蔽寄存器）



EMR（事件屏蔽寄存器）



RTSR（上升沿触发选择寄存器）



FTSR（下降沿触发选择寄存器 ）



SWIER（软件中断时间寄存器）



PR（挂起寄存器）

​     写1清除该位



### 五、中断编号（f103）



```
{

/******  Cortex-M3 Processor Exceptions Numbers ***************************************************/

  NonMaskableInt_IRQn         = -14,    /*!< 2 Non Maskable Interrupt                             */

  MemoryManagement_IRQn       = -12,    /*!< 4 Cortex-M3 Memory Management Interrupt              */

  BusFault_IRQn               = -11,    /*!< 5 Cortex-M3 Bus Fault Interrupt                      */

  UsageFault_IRQn             = -10,    /*!< 6 Cortex-M3 Usage Fault Interrupt                    */

  SVCall_IRQn                 = -5,     /*!< 11 Cortex-M3 SV Call Interrupt                       */

  DebugMonitor_IRQn           = -4,     /*!< 12 Cortex-M3 Debug Monitor Interrupt                 */

  PendSV_IRQn                 = -2,     /*!< 14 Cortex-M3 Pend SV Interrupt                       */

  SysTick_IRQn                = -1,     /*!< 15 Cortex-M3 System Tick Interrupt                   */



/******  STM32 specific Interrupt Numbers *********************************************************/

  WWDG_IRQn                   = 0,      /*!< Window WatchDog Interrupt                            */

  PVD_IRQn                    = 1,      /*!< PVD through EXTI Line detection Interrupt            */

  TAMPER_IRQn                 = 2,      /*!< Tamper Interrupt                                     */

  RTC_IRQn                    = 3,      /*!< RTC global Interrupt                                 */

  FLASH_IRQn                  = 4,      /*!< FLASH global Interrupt                               */

  RCC_IRQn                    = 5,      /*!< RCC global Interrupt                                 */

  EXTI0_IRQn                  = 6,      /*!< EXTI Line0 Interrupt                                 */

  EXTI1_IRQn                  = 7,      /*!< EXTI Line1 Interrupt                                 */

  EXTI2_IRQn                  = 8,      /*!< EXTI Line2 Interrupt                                 */

  EXTI3_IRQn                  = 9,      /*!< EXTI Line3 Interrupt                                 */

  EXTI4_IRQn                  = 10,     /*!< EXTI Line4 Interrupt                                 */

  DMA1_Channel1_IRQn          = 11,     /*!< DMA1 Channel 1 global Interrupt                      */

  DMA1_Channel2_IRQn          = 12,     /*!< DMA1 Channel 2 global Interrupt                      */

  DMA1_Channel3_IRQn          = 13,     /*!< DMA1 Channel 3 global Interrupt                      */

  DMA1_Channel4_IRQn          = 14,     /*!< DMA1 Channel 4 global Interrupt                      */

  DMA1_Channel5_IRQn          = 15,     /*!< DMA1 Channel 5 global Interrupt                      */

  DMA1_Channel6_IRQn          = 16,     /*!< DMA1 Channel 6 global Interrupt                      */

  DMA1_Channel7_IRQn          = 17,     /*!< DMA1 Channel 7 global Interrupt   

 ADC1_2_IRQn                 = 18,     /*!< ADC1 and ADC2 global Interrupt                       */

  USB_HP_CAN1_TX_IRQn         = 19,     /*!< USB Device High Priority or CAN1 TX Interrupts       */

  USB_LP_CAN1_RX0_IRQn        = 20,     /*!< USB Device Low Priority or CAN1 RX0 Interrupts       */

  CAN1_RX1_IRQn               = 21,     /*!< CAN1 RX1 Interrupt                                   */

  CAN1_SCE_IRQn               = 22,     /*!< CAN1 SCE Interrupt                                   */

  EXTI9_5_IRQn                = 23,     /*!< External Line[9:5] Interrupts                        */

  TIM1_BRK_IRQn               = 24,     /*!< TIM1 Break Interrupt                                 */

  TIM1_UP_IRQn                = 25,     /*!< TIM1 Update Interrupt                                */

  TIM1_TRG_COM_IRQn           = 26,     /*!< TIM1 Trigger and Commutation Interrupt               */

  TIM1_CC_IRQn                = 27,     /*!< TIM1 Capture Compare Interrupt                       */

  TIM2_IRQn                   = 28,     /*!< TIM2 global Interrupt                                */

  TIM3_IRQn                   = 29,     /*!< TIM3 global Interrupt                                */

  TIM4_IRQn                   = 30,     /*!< TIM4 global Interrupt                                */

  I2C1_EV_IRQn                = 31,     /*!< I2C1 Event Interrupt                                 */

  I2C1_ER_IRQn                = 32,     /*!< I2C1 Error Interrupt                                 */

  I2C2_EV_IRQn                = 33,     /*!< I2C2 Event Interrupt                                 */

  I2C2_ER_IRQn                = 34,     /*!< I2C2 Error Interrupt                                 */

  SPI1_IRQn                   = 35,     /*!< SPI1 global Interrupt                                */

  SPI2_IRQn                   = 36,     /*!< SPI2 global Interrupt                                */

  USART1_IRQn                 = 37,     /*!< USART1 global Interrupt                              */

  USART2_IRQn                 = 38,     /*!< USART2 global Interrupt                              */

  USART3_IRQn                 = 39,     /*!< USART3 global Interrupt                              */

  EXTI15_10_IRQn              = 40,     /*!< External Line[15:10] Interrupts                      */

  RTCAlarm_IRQn               = 41,     /*!< RTC Alarm through EXTI Line Interrupt                */

  USBWakeUp_IRQn              = 42,     /*!< USB Device WakeUp from suspend through EXTI Line Interrupt */

  TIM8_BRK_IRQn               = 43,     /*!< TIM8 Break Interrupt                                 */

  TIM8_UP_IRQn                = 44,     /*!< TIM8 Update Interrupt                                */

  TIM8_TRG_COM_IRQn           = 45,     /*!< TIM8 Trigger and Commutation Interrupt               */

  TIM8_CC_IRQn                = 46,     /*!< TIM8 Capture Compare Interrupt                       */

  ADC3_IRQn                   = 47,     /*!< ADC3 global Interrupt                                */

  FSMC_IRQn                   = 48,     /*!< FSMC global Interrupt                                */

  SDIO_IRQn                   = 49,     /*!< SDIO global Interrupt                                */

  TIM5_IRQn                   = 50,     /*!< TIM5 global Interrupt                                */

  SPI3_IRQn                   = 51,     /*!< SPI3 global Interrupt                                */

  UART4_IRQn                  = 52,     /*!< UART4 global Interrupt                               */

  UART5_IRQn                  = 53,     /*!< UART5 global Interrupt                               */

  TIM6_IRQn                   = 54,     /*!< TIM6 global Interrupt                                */

  TIM7_IRQn                   = 55,     /*!< TIM7 global Interrupt                                */

  DMA2_Channel1_IRQn          = 56,     /*!< DMA2 Channel 1 global Interrupt                      */

  DMA2_Channel2_IRQn          = 57,     /*!< DMA2 Channel 2 global Interrupt                      */

  DMA2_Channel3_IRQn          = 58,     /*!< DMA2 Channel 3 global Interrupt                      */

  DMA2_Channel4_5_IRQn        = 59      /*!< DMA2 Channel 4 and Channel 5 global Interrupt 

}
```

