---
title: STM8S 复位
date: 2019-03-03 12:50:39
tags:
    - 硬件拾忆
    - STM8
---

---

stm8s 共 9 个复位源：

- NRST 引脚产生的外部复位

- 上电复位（POR）

- 掉电复位（BOR）

- 独立看门狗复位

- 窗口看门狗复位

- 软件复位 

- SWIM 复位

- 非法操作码复位

- EMS 复位：当一些关键的寄存器被破坏或错误加载时产生的复位

<!--more-->

---

### 一、复位电路

![Image.png](https://i.loli.net/2019/03/03/5c7b5d5ae2a63.png)



复位引脚 NRST 内部集成了弱上拉电阻 RPU，既可作为输入，也可作为开漏输出。



一个在复位引脚上宽度最小为 500ns 的低电平脉冲即可产生一个外部复位。对于复位的检测是异步进行的，因此即使 MCU 处于停机（Halt）模式，也有可能进入复位状态。



复位引脚也可以作为开漏输出用于对外部设备进行复位。



无论内部复位源是什么，一旦复位，内部复位电路都会产生一个至少脉宽为 20us 的复位脉冲。当没有外部复位发生时，内部弱上拉电阻可保证复位引脚处于高电平。



---

### 二、内部复位源



除了 POR 和 BOR，每个内部复位源在复位状态寄存器中都有一个标志位与之相对应。复位时，根据导致复位的复位源，这些标志位被分别设置。因此，这些标志位可用于指示引起最后一次复位的复位源。通过软件写 1 可清除标志位。



#### 1、上电复位（POR）和掉电复位（BOR）



上电期间，POR 保持设备处于复位状态，直到供电电压（VDD 和 VDDIO）到达 BOR 的启动电压。此时，BOR 复位取代 POR，POR 自动关闭。BOR 复位一直持续到供电电压到达工作电压。



当工作电压降到们限制 VIT- 以下时，BOR 也将产生一个复位，此后 POR 模块将重新准备好以响应下一次上电复位。



电压迟滞用以保证清楚地检测电压的上升和下降。



即使是 MCU 处于低功耗模式，BOR 也总是保持激活状态。



#### 2、非法操作码复位



为了提高设备的可靠性，防止意外行为的发生，使用了非法操作码检测系统。如果一个被执行的代码与任意操作码或预置字节均不相符，则产生一个复位。此功能与看门狗相配合，可是设备从一个意外错误或干扰中恢复。



一个有效的预置字节与一个有效的操作码组成的一个非法的组合将不会产生复位。



#### 3、EMS 复位



为了避免由电磁干扰造成的对应用程序误写操作或系统挂起，大多数关键寄存器都有一个互补寄存器与之相对应。系统将会自动检测这些关键寄存器与其互补寄存器之间是否匹配。如果不匹配，则产生一个 EMS 复位，从而使应用程序恢复到正常操作。