---
title: STM32 F4 GPIO
tags:
  - 硬件拾忆
  - STM32
abbrlink: 37b6571a
date: 2019-03-04 09:33:30
---

---

1、在 RESET 期间和刚 RESET 之后，IO 端口配置为浮空输入。除了调试接口会在 RESET 之后配置为相应的上下拉模式。



2、每个 AHB1 时钟周期输入寄存器 GPIOx_IDR 捕获当前引脚数据。

<!--more-->

3、输出开漏模式时，只有 N-MOS 工作，写 0 时输出低，写 1 时位高阻态。

输出模式下，施密特触发器输入是开启的。

输出模式下读取输入寄存器可获得 IO 状态，读取输出寄存器可获得上一次写入的值。



4、RESET 之后，所有 IO 连接至第二功能 0（AF0）。



5、外设第二功能映射为从 AF1 到 AF13。



6、RTC_REFIN 引脚应配成浮空输入。



7、MCO1 和 MCO2 引脚必须配成第二功能模式。



8、ADC 和 DAC 配置成模拟功能。



9、通过映射到 AF15 可将 IO 用来输出 CM4 的 FPU EVENTOUT 信号。



10、EVENTOUT 不能映射到P C13，PC14，PC15，PH0，PH1 和 PI8。



11、每组 IO 口有 4 个控制寄存器

| GPIOx_MODER   | select IO direction（Input，Output，AF，Analog）   |
| ------------- | -------------------------------------------------- |
| GPIOx_OTYPER  | select output type（push-pull or open-drain）      |
| GPIOx_OSPEEDR | select speed                                       |
| GPIOx_PUPDR   | select pull-up/pull-down whatever the IO direction |



12、每组 IO 口有 2 个数据寄存器。

| GPIOx_IDR | input  |
| --------- | ------ |
| GPIOx_ODR | output |



13、GPIOx_BSRR 允许对 GPIOx_ODR 寄存器进行位元操作。set 比 reset 的优先级高。位元操作时不需要关闭中断。



14、通过操作 GPIOx_AFRL 和 GPIOx_AFRH 寄存器可以将任一 IO 引脚连接至 16 种第二功能（AF0到AF15）的任意一个。



15、写 GPIOx_LCKR 寄存器需要特定的读写序列，可以锁存 4 个控制寄存器、GPIOx_AFRL 和 GPIOx_AFRH 寄存器。



16、使用 IO 外部中断必须配置成输入 模式。



17、使用模拟功能时，输出 buffer 关闭，施密特触发器关闭，施密特触发器的输出强制为 0，上下拉电阻关闭，读输入寄存器只能读到 0。



18、不使用 LSE 振荡器时，可将 PC14 和 PC15 用作普通 IO。LSE 的优先级比 GPIO 功能高，当 RCC_BDCR 寄存器的 LSEON 位置位时，LSE 振荡器打开 PC14 和 PC15 作为 OSC32_IN 和 OSC32_OFF。

1.2V 域掉电时（器件进入掉电模式），或备份域有 VBAT 供电时，PC14 和 PC15 的 GPIO 功能丧失，这种情况下，处于模拟输入模式。



19、RESET 后，HSE 振荡器默认关闭，此时 PH0/PH1 可以作为普通 IO，而非 OSC_IN 和 OSC_OUT 功能。通过置位 RCC_CR 寄存器的 HSEON 位可开启 HSE 振荡器。HSE 比 GPIO 优先级高。